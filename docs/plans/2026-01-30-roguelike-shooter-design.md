# 飞机大战 Roguelike 射击游戏设计方案

**设计日期**: 2026-01-30
**技术栈**: HTML5 + Phaser 3 + Vite
**风格**: 像素风格

---

## 游戏概述

一个像素风格的飞机射击游戏，融合Roguelike元素。玩家在无尽模式中不断挑战，通过击杀敌人获得经验值，升级时从随机选项中选择强化。每隔固定时间会出现BOSS，击败后进入更高难度的新阶段。

**核心特性**:
- 无尽生存模式
- 经验值升级系统（升级时暂停选择）
- 属性+技能混合升级
- 阶段BOSS战
- 多平台支持（桌面键盘/鼠标，移动端触屏）
- 纯Roguelike（无永久进度，只记录最高分）

---

## 技术架构

### 场景结构（Phaser 3）

- **BootScene** - 资源加载场景
- **MenuScene** - 主菜单（开始游戏、查看最高分）
- **GameScene** - 主游戏场景
- **UpgradeScene** - 升级选择界面（覆盖层）
- **GameOverScene** - 游戏结束界面

### 核心系统

- **Player** - 玩家飞机类（HP、移动、射击）
- **EnemySpawner** - 敌人生成管理器
- **BossManager** - BOSS战管理
- **UpgradeSystem** - 升级池和选项生成
- **ExperienceSystem** - 经验值和等级管理
- **InputManager** - 统一处理键盘/鼠标/触屏输入

---

## 游戏循环与核心机制

### 游戏循环

**正常阶段**（持续2-3分钟）:
1. 敌人按波次生成，难度逐渐提升
2. 玩家击杀敌人获得经验值和分数
3. 经验值满时游戏暂停，弹出升级选择界面
4. 选择1个升级后继续游戏

**BOSS阶段**:
1. 清空所有小怪，BOSS登场
2. BOSS有独特的攻击模式和更高血量
3. 击败BOSS后：阶段+1，难度提升，回到正常阶段
4. 未击败则游戏结束

### 经验值系统

- **经验值掉落**:
  - 小型敌人: 10 XP
  - 中型敌人: 25 XP
  - 大型敌人: 50 XP

- **升级需求**: 100 * 当前等级（线性增长）
- **升级机制**: 随机抽取3个不同的升级选项供选择
- **升级类型**:
  - 可重复选择（属性类）
  - 单次选择（特殊技能）

### 难度递增

每击败一个BOSS后:
- 敌人生成速度 +15%
- 敌人血量 +20%
- 新敌人类型解锁
- 子弹速度 +5%

---

## 升级系统详细设计

### 属性类升级（可重复选择）

| 升级名称 | 效果 |
|---------|------|
| 攻击力提升 | 所有武器伤害 +10% |
| 射速提升 | 射击冷却时间 -15% |
| 移动速度提升 | 飞机移速 +10% |
| 生命值提升 | 最大HP +1（初始3 HP） |
| 弹药容量提升 | 子弹数量 +20% |
| 经验倍率提升 | 获得经验值 +25% |

### 武器类升级（初次获得后可升级强化）

| 武器名称 | 描述 |
|---------|------|
| 双重射击 | 同时发射2颗子弹 |
| 散弹枪 | 发射扇形散弹 |
| 激光 | 穿透性激光武器 |
| 追踪导弹 | 自动追踪最近敌人 |
| 侧翼炮 | 飞机两侧额外武器 |

### 特殊技能升级（限1次）

| 技能名称 | 效果 |
|---------|------|
| 护盾 | 抵挡1次伤害后恢复（冷却30秒） |
| 磁铁 | 自动吸收附近经验值 |
| 子弹时间 | 血量低于1时触发短暂减速（每局1次） |
| 吸血 | 击杀敌人有10%概率恢复1 HP |
| 穿透子弹 | 子弹可穿透敌人 |
| 暴击 | 15%概率造成双倍伤害 |

---

## 敌人与BOSS设计

### 敌人类型

| 类型 | 解锁阶段 | 行为 | HP | 分数 | 经验 |
|-----|---------|------|----|----|-----|
| 基础敌机 | 1 | 直线向下飞行，不射击 | 1 | 10 | 10 |
| 射击敌机 | 1 | 向下飞行，定期射击 | 2 | 20 | 15 |
| 追踪敌机 | 2 | 缓慢追踪玩家 | 3 | 30 | 25 |
| 重型轰炸机 | 3 | 横向移动，发射散弹 | 5 | 50 | 40 |
| 快速战机 | 4 | 之字形快速移动 | 2 | 40 | 30 |

### BOSS设计

- **BOSS 1-2**: 大型敌机，三路弹幕，简单移动模式
- **BOSS 3-4**: 攻击阶段变化（弹幕 → 冲刺 → 弹幕）
- **BOSS 5+**: 复杂弹幕图案，召唤小怪，多阶段血量

**BOSS数值**:
- 血量: 500 * 阶段数
- 击败奖励: 1000分 + 200经验

---

## 输入控制与UI设计

### 多平台输入控制

**桌面端**:
- **键盘**: WASD/方向键控制移动，空格射击（或自动射击）
- **鼠标**: 鼠标移动控制飞机位置，左键射击（或自动射击）

**移动端**:
- **触屏**: 手指拖动控制飞机位置，自动射击
- **虚拟摇杆**（可选）: 左下角虚拟摇杆控制移动

**输入抽象层**:
- `InputManager`统一处理所有输入，输出标准化的`{x, y, shoot}`数据
- 自动检测设备类型，切换对应输入方式
- 触屏时隐藏鼠标提示，桌面端隐藏虚拟摇杆

### UI布局

- **左上角**: HP显示（心形图标）、当前等级、经验条
- **右上角**: 当前分数、最高分、当前阶段
- **升级界面**: 屏幕中央3个卡片，显示升级名称、图标、描述
- **游戏结束界面**: 最终分数、最高分、重新开始按钮

---

## 项目结构

```
shoot-a-plane/
├── index.html          # 游戏入口
├── assets/             # 资源文件
│   ├── sprites/        # 像素图片（飞机、敌人、子弹）
│   ├── audio/          # 音效和背景音乐
│   └── fonts/          # 像素字体
├── src/
│   ├── main.js         # 游戏初始化和配置
│   ├── scenes/         # Phaser场景
│   │   ├── BootScene.js
│   │   ├── MenuScene.js
│   │   ├── GameScene.js
│   │   ├── UpgradeScene.js
│   │   └── GameOverScene.js
│   ├── entities/       # 游戏实体
│   │   ├── Player.js
│   │   ├── Enemy.js
│   │   ├── Boss.js
│   │   └── Bullet.js
│   ├── systems/        # 游戏系统
│   │   ├── InputManager.js
│   │   ├── UpgradeSystem.js
│   │   ├── EnemySpawner.js
│   │   ├── ExperienceSystem.js
│   │   └── BossManager.js
│   ├── config/         # 配置数据
│   │   ├── upgrades.js     # 升级选项配置
│   │   ├── enemies.js      # 敌人配置
│   │   └── gameConfig.js   # 游戏常量
│   └── utils/          # 工具函数
│       └── storage.js  # 本地存储（最高分）
└── package.json
```

---

## 技术实现细节

### 游戏状态管理

```javascript
GameState = {
  player: {
    hp: number,
    maxHp: number,
    level: number,
    exp: number,
    nextLevelExp: number,
    upgrades: []
  },
  game: {
    score: number,
    stage: number,
    isPaused: boolean,
    highScore: number
  },
  spawner: {
    spawnRate: number,
    difficulty: number,
    currentWave: number
  }
}
```

### 碰撞检测（Phaser Arcade Physics）

- `player` vs `enemyBullets` → 玩家受伤
- `playerBullets` vs `enemies` → 敌人受伤，掉落经验
- `player` vs `experienceOrbs` → 获得经验
- `player` vs `enemies` → 玩家受伤，敌人销毁

### 性能优化

- **对象池**: 子弹和敌人使用对象池复用，避免频繁创建/销毁
- **屏幕外销毁**: 超出屏幕边界的实体自动销毁
- **粒子系统限制**: 同屏最多50个粒子效果
- **分辨率**: 默认800x600，支持缩放适配不同屏幕

### 本地存储

- **保存数据**: `{highScore: number, gamesPlayed: number}`
- **存储方式**: LocalStorage
- **更新时机**: 游戏结束时更新

---

## 开发流程建议

1. **基础游戏循环**: 实现玩家移动+射击
2. **敌人系统**: 添加敌人生成和碰撞检测
3. **经验值系统**: 实现经验值和升级机制
4. **BOSS战**: 添加BOSS战斗系统
5. **完善UI**: 完善用户界面和音效
6. **移动端适配**: 触屏控制和响应式布局测试

---

## 技术栈

- **游戏引擎**: Phaser 3.60+
- **构建工具**: Vite（快速开发和热更新）
- **本地存储**: LocalStorage
- **样式**: 像素风格美术资源

---

**设计完成日期**: 2026-01-30
